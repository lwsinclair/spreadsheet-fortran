#!/usr/bin/expect -f
#
# Simple test - just login to CP-V
#

set timeout 60
log_user 1

puts "Connecting..."
spawn nc localhost 5001

puts "Waiting for any output..."
expect {
    -re "." {
        puts "\nReceived some output, waiting for more..."
    }
    timeout {
        puts "ERROR: No output at all"
        exit 1
    }
}

# Wait a bit more
sleep 5

# Try sending the login
puts "\nSending login command..."
send ":SYS,LBE\r"

# Wait for response
expect {
    -re "!|\\$" {
        puts "\nGot prompt!"
    }
    -re "." {
        puts "\nGot some response..."
        exp_continue
    }
    timeout {
        puts "\nTimeout waiting for prompt"
    }
}

puts "\nDone - leaving connection open..."
interact
