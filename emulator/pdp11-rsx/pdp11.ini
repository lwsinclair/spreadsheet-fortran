; PDP-11/70 with RSX-11M V3.2 Configuration for XL Spreadsheet Testing
; Based on PDP Nostalgia RSX-11M guide
; See: docs/PDP Nostalgia - RSX-11M.html

; Enable console logging
SET CONSOLE LOG=console.log
SET CONSOLE DEBUG=STDERR

echo ======================================================================
echo PDP-11/70 Emulator for RSX-11M V3.2
echo XL Spreadsheet Testing Environment
echo ======================================================================

; Set CPU to PDP-11/70
SET CPU 11/70
SET CPU 1M
SET CPU FPP
SET CPU IDLE

echo CPU Configuration:
SHOW CPU

; Clock (already enabled by default)
echo KW11-L Line Clock:
SHOW CLK

; RP06 disk controller (176700/254) for system disk
SET RHA ENABLE
SET RP0 RP06
SET RP1 RP06
echo RHA RP06 Disk Controller:
SHOW RHA

; RL01/RL02 disk controller for install media and work disk
SET RL ENABLE
SET RL0 ENABLE,RL01,WRITEENABLED
ATTACH RL0 media/RSX-11M_V3.2_RSX11MBL26_3.2.rl01
SET RL1 ENABLE,RL01,WRITEENABLED
SET RL2 ENABLE,RL02,WRITEENABLED
ATTACH RL2 media/xl_work.rl02
SET RL3 ENABLE,RL02,WRITEENABLED
echo RL01/RL02 Disk Controller:
SHOW RL

; RK05 disk controller (optional)
SET RK ENABLE
echo RK05 Disk Controller:
SHOW RK

; DZ11 terminal multiplexer (8 lines)
SET DZ ENABLE
SET DZ LINES=8
echo DZ11 Terminal Multiplexer:
SHOW DZ

; TM11 tape controller (disabled for now)
SET TM DISABLE

; Separate console on telnet port 10070
SET CONSOLE TELNET=10070

; DZ11 terminals configuration
; Note: DZ11 uses single port with line selection
; Telnet to console port for now

; Open console terminal automatically (macOS)
; osascript -e 'tell application "Terminal" to do script "telnet localhost 10070"'

echo ======================================================================
echo
echo Console terminal: telnet localhost 10070
echo DZ11 line 0:      telnet localhost 10071
echo DZ11 line 1:      telnet localhost 10072
echo   ... through line 7: telnet localhost 10078
echo
echo ======================================================================
echo
echo To boot RSX-11M, type: BOOT RL0
echo To exit simulator, type: QUIT or Ctrl-E then QUIT
echo
echo ======================================================================

; Auto-boot from RL0 (RSX-11M system disk)
; BOOT RL0

; Don't auto-boot yet - let user manually boot first time
; This allows checking configuration before booting
